#!/usr/bin/env ruby

require './config/environment'

team = Team.find_by_acronym("BAMRU")

group_opts = [
  {
    name: "Ranks", acronym: "RA"
  },
  {
    name: "Roles", acronym: "RO"
  },
  {
    name: "Deployable", acronym: "DE"
  },
  {
    name: "Base", acronym: "BA"
  },
  {
    name: "Submittable", acronym: "SUB"
  },
  {
    name: "Sworn", acronym: "SWORN"
  }
].map {|el| el.merge({team: team})}

Cert::Group.create group_opts

unit_role_opts = [
  {
    name: "Board of Directors", acronym: "BD"
  },
  {
    name: "Unit Leader", acronym: "UL"
  },
  {
    name: "Operations Officer", acronym: "OO"
  },
  {
    name: "Executive Officer", acronym: "XO"
  },
  {
    name: "Secretary", acronym: "S"
  },
  {
    name: "Treasurer", acronym: "T"
  },
  {
    name: "Training Officer", acronym: "TO"
  },
  {
    name: "Recruiting Officer", acronym: "RO"
  }
].map {|el| el.merge({team: team})}

Cert::Def.create unit_role_opts

unit_rank_opts = [
  {
    name: "Technical Member", acronym: "TM"
  },
  {
    name: "Field Member", acronym: "FM"
  },
  {
    name: "Trainee", acronym: "T"
  },
  {
    name: "Reserve", acronym: "R"
  },
  {
    name: "Support", acronym: "S"
  },
  {
    name: "Associate", acronym: "A"
  },
  {
    name: "Guest", acronym: "G"
  },
].map {|el| el.merge({team: team})}

Cert::Def.create unit_rank_opts

rank_group = Cert::Group.by_acronym("RA").all.first
role_group = Cert::Group.by_acronym("RO").all.first

unit_rank_opts.each do |el|
  desc = Cert::Def.where(name: el[:name]).all.first
  Cert::Grouptie.create(cert_group: rank_group, cert_def: desc)
end

unit_role_opts.each do |el|
  desc = Cert::Def.where(name: el[:name]).all.first
  Cert::Grouptie.create(cert_group: role_group, cert_def: desc)
end

def assign(uname, aname, acronym)
  team = Team.find_by_acronym("BAMRU")
  uusr = User.where(user_name: uname).first
  ausr = User.where(user_name: aname).first
  umem = team.memberships.where(user_id: uusr.id).first
  amem = team.memberships.where(user_id: ausr.id).first
  
  Cert::Profile.create({
    membership_id: umem.id                                     ,
    cert_def_id:   Cert::Def.where(acronym: acronym).first.id  ,
    cert_fact_id:  Cert::Fact.create({
      user_id:     uusr.id       ,
      assigner_id: amem.id       ,
      comment:     "assign #{uusr.first_name} to #{acronym}"
    }).id
  })
end

assign "johnc"  , "craigt" , "UL"
assign "johnc"  , "craigt" , "TM"
assign "andyl"  , "craigt" , "FM"
assign "craigt" , "johnc"  , "BD"
assign "craigt" , "johnc"  , "FM"

puts "CertDefs:      " + Cert::Def.count.to_s
puts "CertGroups:    " + Cert::Group.count.to_s
puts "CertGroupties: " + Cert::Grouptie.count.to_s
puts "CertGroupties: " + Cert::Grouptie.count.to_s
puts "CertProfiles:  " + Cert::Profile.count.to_s
puts "CertFacts:     " + Cert::Fact.count.to_s
